<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spinzy v4</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    :root {
      --bg: #ffffff;
      --text: #222222;
      --accent: #007bff;
      --card-bg: #f9f9f9;
    }
    body.dark {
      --bg: #121212;
      --text: #f0f0f0;
      --card-bg: #1e1e1e;
    }
    header {
      padding: 1rem;
      background: var(--card-bg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    header h1 { margin: 0; }
    .theme-toggle {
      cursor: pointer;
      border: 1px solid var(--text);
      padding: 0.3rem 0.6rem;
      border-radius: 5px;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }
    .wheel-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 1rem;
    }
    canvas {
      width: 80vw;
      max-width: 800px;
      height: auto;
      cursor: pointer;
    }
    .name-list {
      margin-top: 1rem;
      background: var(--card-bg);
      padding: 1rem;
      border-radius: 10px;
      width: 300px;
      max-width: 90vw;
    }
    .winner-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      display: none;
      z-index: 100;
    }
    .winner-modal button {
      margin: 0.5rem;
    }
    .wheel-tabs {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }
    .tab {
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      background: var(--card-bg);
    }
    .tab.active {
      background: var(--accent);
      color: #fff;
    }
    button {
      cursor: pointer;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      background: var(--accent);
      color: #fff;
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸŽ¡ Spinzy</h1>
    <div class="theme-toggle" id="themeToggle">ðŸŒ™</div>
  </header>
  <div class="container">
    <div id="wheelArea"></div>
    <div class="wheel-tabs" id="wheelTabs"></div>
    <button id="addWheel">âž• Add Wheel</button>
  </div>

  <div class="winner-modal" id="winnerModal">
    <h2 id="winnerName">Winner!</h2>
    <button id="removeWinnerBtn">Remove Winner</button>
    <button id="closeModal">Close</button>
  </div>

  <audio id="winSound" src="win-sound.mp3"></audio>

  <script>
    const colors = ["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#e67e22","#ff69b4"];
    let wheels = [];
    let activeWheel = 0;

    const wheelArea = document.getElementById("wheelArea");
    const wheelTabs = document.getElementById("wheelTabs");
    const winnerModal = document.getElementById("winnerModal");
    const winnerNameEl = document.getElementById("winnerName");
    const removeWinnerBtn = document.getElementById("removeWinnerBtn");
    const closeModal = document.getElementById("closeModal");
    const winSound = document.getElementById("winSound");

    function createWheel(title="Untitled Wheel") {
      const container = document.createElement("div");
      container.className = "wheel-container";

      const titleInput = document.createElement("input");
      titleInput.value = title;
      titleInput.style.fontSize = "1.2rem";
      titleInput.style.textAlign = "center";
      titleInput.style.marginBottom = "0.5rem";

      const canvas = document.createElement("canvas");
      canvas.width = 800;
      canvas.height = 800;

      const listDiv = document.createElement("div");
      listDiv.className = "name-list";
      listDiv.innerHTML = \`
        <input type="text" id="newName" placeholder="Add a name" style="width:100%;margin-bottom:0.5rem;">
        <button id="resetList">Reset List</button>
        <ul id="namesUl"></ul>
      \`;

      container.appendChild(titleInput);
      container.appendChild(canvas);
      container.appendChild(listDiv);
      wheelArea.appendChild(container);

      const ctx = canvas.getContext("2d");
      let names = ["Alice","Bob","Charlie","Dana"];
      let spinning = false;
      let angle = 0;
      let spinAngle = 0;

      function drawWheel() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        const sliceAngle = 2*Math.PI/names.length;
        names.forEach((name,i)=>{
          ctx.beginPath();
          ctx.moveTo(canvas.width/2, canvas.height/2);
          ctx.arc(canvas.width/2, canvas.height/2, canvas.width/2, i*sliceAngle, (i+1)*sliceAngle);
          ctx.fillStyle = colors[i % colors.length];
          ctx.fill();
          ctx.save();
          ctx.translate(canvas.width/2, canvas.height/2);
          ctx.rotate(i*sliceAngle + sliceAngle/2);
          ctx.fillStyle = "#fff";
          ctx.font = "20px Arial";
          ctx.textAlign = "right";
          ctx.fillText(name, canvas.width/2 - 10, 10);
          ctx.restore();
        });
        // center text if not spinning yet
        if(!spinning && spinAngle===0){
          ctx.fillStyle = "#000";
          ctx.font = "bold 24px Arial";
          ctx.textAlign = "center";
          ctx.fillText("Push to Spin", canvas.width/2, canvas.height/2+10);
        }
      }

      function spinWheel(){
        if(spinning || names.length===0) return;
        spinning = true;
        spinAngle = Math.random()*Math.PI*10 + Math.PI*20;
        let duration = 4000;
        const start = performance.now();
        function animate(now){
          const elapsed = now-start;
          if(elapsed<duration){
            angle = spinAngle * (1 - (elapsed/duration)) + elapsed/50;
            ctx.save();
            ctx.translate(canvas.width/2,canvas.height/2);
            ctx.rotate(angle);
            ctx.translate(-canvas.width/2,-canvas.height/2);
            drawWheel();
            ctx.restore();
            requestAnimationFrame(animate);
          } else {
            spinning = false;
            angle = angle % (2*Math.PI);
            const sliceAngle = 2*Math.PI/names.length;
            const winningIndex = Math.floor((names.length - (angle/(2*Math.PI))*names.length) % names.length);
            const winner = names[winningIndex];
            showWinner(winner, winningIndex);
          }
        }
        requestAnimationFrame(animate);
      }

      function showWinner(winner, index){
        winnerNameEl.textContent = "ðŸŽ‰ " + winner + " ðŸŽ‰";
        winnerModal.style.display = "block";
        winSound.play();
        removeWinnerBtn.onclick = ()=>{
          names.splice(index,1);
          updateList();
          winnerModal.style.display = "none";
          drawWheel();
        };
      }

      function updateList(){
        const ul = listDiv.querySelector("#namesUl");
        ul.innerHTML="";
        names.forEach((n,i)=>{
          const li=document.createElement("li");
          const span=document.createElement("span");
          span.textContent=n;
          span.onclick=()=>{
            const input=document.createElement("input");
            input.value=n;
            input.onblur=()=>{ names[i]=input.value; updateList(); drawWheel(); };
            input.onkeydown=(e)=>{ if(e.key==="Enter"){ input.blur(); } };
            li.replaceChild(input,span);
            input.focus();
          };
          li.appendChild(span);
          ul.appendChild(li);
        });
      }

      listDiv.querySelector("#newName").addEventListener("keydown",e=>{
        if(e.key==="Enter" && e.target.value.trim()!==""){
          names.push(e.target.value.trim());
          e.target.value="";
          updateList();
          drawWheel();
        }
      });
      listDiv.querySelector("#resetList").onclick=()=>{
        names=[];
        updateList();
        drawWheel();
      };

      canvas.addEventListener("click", spinWheel);
      closeModal.onclick=()=>{ winnerModal.style.display="none"; };

      updateList();
      drawWheel();

      return {container,canvas,drawWheel};
    }

    function setActiveWheel(index){
      wheels.forEach((w,i)=>{
        w.container.style.display = (i===index)?"block":"none";
      });
      Array.from(wheelTabs.children).forEach((tab,i)=>{
        tab.classList.toggle("active", i===index);
      });
      activeWheel=index;
    }

    function renderTabs(){
      wheelTabs.innerHTML="";
      wheels.forEach((w,i)=>{
        const tab=document.createElement("div");
        tab.className="tab"+(i===activeWheel?" active":"");
        tab.textContent="Wheel "+(i+1);
        tab.onclick=()=>setActiveWheel(i);
        wheelTabs.appendChild(tab);
      });
    }

    document.getElementById("addWheel").onclick=()=>{
      wheels.push(createWheel("New Wheel"));
      renderTabs();
      setActiveWheel(wheels.length-1);
    };

    // Init with one wheel
    wheels.push(createWheel("Default Wheel"));
    renderTabs();
    setActiveWheel(0);

    // Theme toggle
    const themeToggle=document.getElementById("themeToggle");
    if(localStorage.getItem("theme")==="dark"){ document.body.classList.add("dark"); }
    themeToggle.onclick=()=>{
      document.body.classList.toggle("dark");
      localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");
    };
  </script>
</body>
</html>
