<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spinzy v2</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f6fa;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      display: flex;
      flex-direction: row;
      gap: 2rem;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      width: 100%;
      padding: 1rem;
    }
    #wheelCanvas {
      width: 400px;
      height: 400px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    #wheelCanvas:hover {
      transform: scale(1.05);
    }
    .list-container {
      flex: 1;
      min-width: 200px;
      max-width: 300px;
    }
    .list-container input {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .list-container button {
      padding: 0.5rem;
      margin-bottom: 1rem;
      width: 100%;
      background: #3498db;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      padding: 0.3rem;
      background: #ecf0f1;
      margin-bottom: 0.2rem;
      border-radius: 4px;
    }
    @media(max-width: 768px) {
      .container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¡ Spinzy</h1>
  <div class="container">
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
    <div class="list-container">
      <input type="text" id="nameInput" placeholder="Enter a name" />
      <button onclick="addName()">Add Name</button>
      <ul id="nameList"></ul>
    </div>
  </div>
  <audio id="winSound" src="win-sound.mp3" preload="auto"></audio>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    let names = ['Alice', 'Bob', 'Charlie', 'Diana'];
    let rotation = 0;
    let spinning = false;
    let idleAngle = 0;

    function drawWheel() {
      const numSlices = names.length;
      const anglePerSlice = (2 * Math.PI) / numSlices;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(canvas.width/2, canvas.height/2);
      ctx.rotate(rotation + idleAngle);

      for (let i=0; i<numSlices; i++) {
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.fillStyle = i % 2 === 0 ? '#3498db' : '#e74c3c';
        ctx.arc(0,0,200,i*anglePerSlice,(i+1)*anglePerSlice);
        ctx.fill();
        ctx.save();
        ctx.fillStyle = 'white';
        ctx.rotate(i*anglePerSlice + anglePerSlice/2);
        ctx.textAlign = 'right';
        ctx.font = '16px Arial';
        ctx.fillText(names[i], 190, 5);
        ctx.restore();
      }

      ctx.restore();
      // Arrow
      ctx.fillStyle = '#2c3e50';
      ctx.beginPath();
      ctx.moveTo(canvas.width/2, 0);
      ctx.lineTo(canvas.width/2 - 15, 30);
      ctx.lineTo(canvas.width/2 + 15, 30);
      ctx.closePath();
      ctx.fill();
    }

    function spinWheel() {
      if(spinning || names.length === 0) return;
      spinning = true;
      let spinTime = 4000; // 4 seconds
      let spinAngle = Math.random() * Math.PI * 6 + Math.PI * 6; // 3-6 full rotations
      let start = null;

      function animate(timestamp) {
        if(!start) start = timestamp;
        let progress = timestamp - start;
        rotation = easeOut(progress, 0, spinAngle, spinTime);
        drawWheel();

        if(progress < spinTime) {
          requestAnimationFrame(animate);
        } else {
          spinning = false;
          declareWinner();
        }
      }
      requestAnimationFrame(animate);
    }

    function easeOut(t, b, c, d) {
      t /= d;
      t--;
      return c * (t*t*t + 1) + b;
    }

    function declareWinner() {
      const numSlices = names.length;
      const anglePerSlice = (2 * Math.PI) / numSlices;
      let winningAngle = (2 * Math.PI - (rotation % (2*Math.PI))) % (2*Math.PI);
      let index = Math.floor(winningAngle / anglePerSlice);
      let winner = names[index];
      alert("ðŸŽ‰ Winner: " + winner + "!");
      document.getElementById("winSound").play();
      confetti();
    }

    function addName() {
      const input = document.getElementById('nameInput');
      if(input.value.trim() !== "") {
        names.push(input.value.trim());
        input.value = "";
        updateList();
        drawWheel();
      }
    }

    function updateList() {
      const ul = document.getElementById('nameList');
      ul.innerHTML = "";
      names.forEach(name => {
        const li = document.createElement('li');
        li.textContent = name;
        ul.appendChild(li);
      });
    }

    canvas.addEventListener('click', spinWheel);

    // Idle spin
    function idleSpin() {
      if(!spinning) {
        idleAngle += 0.002;
        drawWheel();
      }
      requestAnimationFrame(idleSpin);
    }

    updateList();
    drawWheel();
    idleSpin();
  </script>
</body>
</html>
