<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spinzy v3</title>
  <style>
    :root {
      --accent: #2c3e50;
      --bg: #f5f6fa;
      --card: #ffffff;
      --btn: #3498db;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: #222;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      width: 100%;
      padding: 1rem 1.25rem;
      text-align: center;
    }
    h1 { margin: 0.25rem 0 0; font-size: 1.8rem; }
    .app {
      width: 100%;
      max-width: 1200px;
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 1.5rem;
      padding: 1rem;
      align-items: start;
    }
    .canvas-wrap {
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      padding: 1rem;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    canvas {
      width: min(90vw, 800px);
      height: auto;
      max-width: 800px;
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.15s ease;
      touch-action: manipulation;
    }
    canvas:hover { transform: scale(1.01); }
    .pointer {
      position: absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 16px solid transparent;
      border-right: 16px solid transparent;
      border-bottom: 24px solid var(--accent);
      filter: drop-shadow(0 2px 2px rgba(0,0,0,.2));
      pointer-events: none;
    }
    .panel {
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      padding: 1rem;
    }
    .row { display: flex; gap: .5rem; }
    input[type=text] {
      flex: 1;
      padding: .6rem .7rem;
      border: 1px solid #d0d7de;
      border-radius: 10px;
      font-size: 1rem;
      outline: none;
    }
    button {
      background: var(--btn);
      color: #fff;
      border: 0;
      border-radius: 10px;
      padding: .6rem .9rem;
      font-size: 1rem;
      cursor: pointer;
    }
    button:hover { filter: brightness(0.95); }
    ul { list-style: none; padding: 0; margin: .75rem 0 0; max-height: 60vh; overflow: auto; }
    li {
      display: flex; align-items: center; gap: .5rem;
      background: #f0f3f6; padding: .5rem .6rem; border-radius: 8px; margin-bottom: .4rem;
    }
    .name-span { flex: 1; padding: .3rem .4rem; border-radius: 6px; cursor: text; }
    .name-input { flex: 1; padding: .4rem .5rem; border: 1px solid #c8d1da; border-radius: 6px; }
    .tiny { background: #95a5a6; }
    .options { margin-top: .5rem; display: flex; align-items: center; gap: .5rem; }
    label { font-size: .9rem; color: #444; }
    .hint { color: #6b7280; font-size: .9rem; margin-top: .4rem; }
    /* Winner Modal */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,.35);
      display: none; align-items: center; justify-content: center;
      z-index: 50;
    }
    .modal {
      background: #fff; border-radius: 16px; padding: 1rem 1rem 1.1rem;
      width: min(92vw, 420px); box-shadow: 0 20px 60px rgba(0,0,0,.25);
      text-align: center;
    }
    .winner-name { font-size: 1.6rem; font-weight: 700; margin: .5rem 0 1rem; }
    .modal .row { justify-content: center; }
    /* Responsive */
    @media (max-width: 900px) {
      .app { grid-template-columns: 1fr; }
      ul { max-height: 30vh; }
    }
  </style>
</head>
<body>
  <header>
    <div>ðŸŽ¡</div>
    <h1>Spinzy</h1>
  </header>

  <main class="app">
    <section class="canvas-wrap">
      <div class="pointer"></div>
      <!-- Use a high-resolution canvas for crispness; CSS scales it down if needed -->
      <canvas id="wheel" width="800" height="800" aria-label="Spin wheel (click to spin)"></canvas>
    </section>

    <aside class="panel">
      <div class="row">
        <input id="nameInput" type="text" placeholder="Enter a name and press Add" />
        <button id="addBtn">Add</button>
      </div>
      <div class="hint">Tip: click a name to edit it. Press Enter to save.</div>
      <ul id="nameList"></ul>
      <div class="options">
        <input type="checkbox" id="removeAfter" />
        <label for="removeAfter">Remove winner after spin (via button)</label>
      </div>
    </aside>
  </main>

  <!-- Winner Modal -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="winnerTitle">
    <div class="modal">
      <div id="winnerTitle" class="winner-name">Winner: <span id="winnerText"></span></div>
      <div class="row">
        <button id="removeBtn">Remove Winner</button>
        <button id="closeBtn" class="tiny">Close</button>
      </div>
    </div>
  </div>

  <audio id="winSound" src="win-sound.mp3" preload="auto"></audio>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    // ====== State ======
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const nameInput = document.getElementById('nameInput');
    const addBtn = document.getElementById('addBtn');
    const nameList = document.getElementById('nameList');
    const removeAfter = document.getElementById('removeAfter');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const winnerText = document.getElementById('winnerText');
    const removeBtn = document.getElementById('removeBtn');
    const closeBtn = document.getElementById('closeBtn');
    const winSound = document.getElementById('winSound');

    let names = ['Alice', 'Bob', 'Charlie', 'Diana', 'Eli', 'Fiona', 'Gabe', 'Hana'];
    let rotation = 0;
    let spinning = false;
    let idle = true; // Idle rotate until first spin
    let showCenterLabel = true;

    const COLORS = ['#ef4444','#f97316','#f59e0b','#eab308','#84cc16','#22c55e','#14b8a6','#06b6d4','#3b82f6','#6366f1','#8b5cf6','#a855f7','#ec4899','#f43f5e'];
    // ====== Helpers ======
    function drawWheel() {
      const n = Math.max(1, names.length);
      const angle = (2 * Math.PI) / n;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(canvas.width/2, canvas.height/2);
      ctx.rotate(rotation);

      // slices
      for (let i = 0; i < n; i++) {
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.fillStyle = COLORS[i % COLORS.length];
        ctx.arc(0,0,380, i*angle, (i+1)*angle);
        ctx.closePath();
        ctx.fill();

        // labels
        ctx.save();
        ctx.rotate(i*angle + angle/2);
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 22px system-ui, Arial';
        ctx.textAlign = 'right';
        ctx.fillText(names[i] || '', 360, 8);
        ctx.restore();
      }

      // Center hub
      ctx.beginPath();
      ctx.fillStyle = '#fff';
      ctx.arc(0,0,70,0,2*Math.PI);
      ctx.fill();
      ctx.lineWidth = 6;
      ctx.strokeStyle = 'rgba(0,0,0,.06)';
      ctx.stroke();

      // Center text
      if (showCenterLabel) {
        ctx.fillStyle = '#111';
        ctx.font = '600 20px system-ui, Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('Push to Spin', 0, 0);
      }

      ctx.restore();
    }

    function idleSpin() {
      if (idle && !spinning) {
        rotation += 0.0018; // gentle idle motion
        drawWheel();
      }
      requestAnimationFrame(idleSpin);
    }

    function easeOutCubic(t, b, c, d) {
      t /= d; t--;
      return c*(t*t*t + 1) + b;
    }

    function spinWheel() {
      if (spinning || names.length === 0) return;
      spinning = true;
      idle = false;
      showCenterLabel = false;

      const duration = 6000 + Math.random()*2000; // 6-8s
      const extraRot = (Math.PI*6) + Math.random()*Math.PI*4; // 3-5 extra spins
      let startRot = rotation;
      let start = null;

      function animate(ts) {
        if (!start) start = ts;
        const elapsed = ts - start;
        rotation = easeOutCubic(elapsed, startRot, extraRot, duration);
        drawWheel();
        if (elapsed < duration) {
          requestAnimationFrame(animate);
        } else {
          spinning = false;
          rotation = rotation % (2*Math.PI);
          onSpinEnd();
        }
      }
      requestAnimationFrame(animate);
    }

    function onSpinEnd() {
      const n = names.length;
      if (n === 0) return;
      const sliceAngle = (2*Math.PI)/n;
      // Pointer at top; winner is slice whose center crosses angle 0
      const winningAngle = (2*Math.PI - rotation) % (2*Math.PI);
      let index = Math.floor(winningAngle / sliceAngle);
      // guard
      index = Math.min(Math.max(index, 0), n-1);
      const winner = names[index];
      showWinnerModal(winner, index);
      // effects
      try { winSound.currentTime = 0; winSound.play(); } catch(e) {}
      confetti({ particleCount: 120, spread: 80, startVelocity: 45, origin: { y: 0.2 } });
    }

    function showWinnerModal(name, index) {
      winnerText.textContent = name;
      modalBackdrop.style.display = 'flex';

      function handleRemove() {
        if (!removeAfter.checked) { close(); return; }
        names.splice(index, 1);
        updateList();
        drawWheel();
        close();
      }
      function close() {
        modalBackdrop.style.display = 'none';
        removeBtn.removeEventListener('click', handleRemove);
        closeBtn.removeEventListener('click', close);
      }
      removeBtn.addEventListener('click', handleRemove);
      closeBtn.addEventListener('click', close);
    }

    // ====== List UI ======
    function updateList() {
      nameList.innerHTML = '';
      names.forEach((n, i) => {
        const li = document.createElement('li');

        const span = document.createElement('span');
        span.className = 'name-span';
        span.textContent = n;
        span.title = 'Click to edit';
        span.addEventListener('click', () => startEdit(i, span));

        li.appendChild(span);
        nameList.appendChild(li);
      });
    }

    function startEdit(index, spanEl) {
      const input = document.createElement('input');
      input.className = 'name-input';
      input.value = names[index];
      spanEl.replaceWith(input);
      input.focus();
      input.setSelectionRange(0, input.value.length);

      function commit() {
        const v = input.value.trim();
        if (v === '') {
          // remove empty
          names.splice(index, 1);
        } else {
          names[index] = v;
        }
        updateList();
        drawWheel();
      }
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') commit();
        if (e.key === 'Escape') updateList();
      });
      input.addEventListener('blur', commit);
    }

    addBtn.addEventListener('click', () => {
      const v = nameInput.value.trim();
      if (!v) return;
      names.push(v);
      nameInput.value = '';
      updateList();
      drawWheel();
    });
    nameInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') addBtn.click();
    });

    canvas.addEventListener('click', spinWheel);

    // Init
    updateList();
    drawWheel();
    idleSpin();
  </script>
</body>
</html>
