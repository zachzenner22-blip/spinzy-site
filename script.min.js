(()=>{
let wheels=[{title:"Default Wheel",names:["Alice","Bob","Charlie","Diana"]}];
let activeWheel=0,spinning=false,angle=0,spinTimeout;
const canvas=document.getElementById("wheelCanvas"),ctx=canvas.getContext("2d"),spinBtn=document.getElementById("spinButton"),winnerBox=document.getElementById("winner-box"),nav=document.getElementById("wheel-nav");

function drawWheel(){
  let wheel=wheels[activeWheel];if(!wheel)return;
  let {names}=wheel,arc=2*Math.PI/names.length;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  names.forEach((name,i)=>{
    let start=angle+i*arc,end=start+arc;
    ctx.beginPath();ctx.moveTo(250,250);ctx.arc(250,250,250,start,end);ctx.fillStyle=`hsl(${i*360/names.length},80%,60%)`;ctx.fill();ctx.stroke();
    ctx.save();ctx.translate(250,250);ctx.rotate(start+arc/2);ctx.fillStyle="#000";ctx.font="16px sans-serif";ctx.fillText(name,120,5);ctx.restore();
  });
  ctx.beginPath();ctx.moveTo(250,0);ctx.lineTo(240,20);ctx.lineTo(260,20);ctx.closePath();ctx.fillStyle=ctx.strokeStyle=ctx.getImageData(250,1,1,1).data?"#000":"#000";ctx.fill();ctx.stroke();
}
function spinWheel(){
  if(spinning)return;spinning=true;let duration=3000,spinAngle=Math.random()*360+720,start=performance.now();
  function animate(now){let progress=(now-start)/duration;if(progress<1){angle+=(spinAngle*(1-Math.pow(1-progress,3)))*Math.PI/180;drawWheel();requestAnimationFrame(animate);}else{spinning=false;finishSpin();}}
  requestAnimationFrame(animate);
}
function finishSpin(){
  let wheel=wheels[activeWheel];if(!wheel)return;
  let arc=2*Math.PI/wheel.names.length,winningIndex=Math.floor(((2*Math.PI-angle%(2*Math.PI))/(arc))%wheel.names.length);
  let winner=wheel.names[winningIndex];
  winnerBox.innerHTML=`<div>Winner: <b>${winner}</b></div><button id='remove-winner'>Remove Winner</button>`;
  document.getElementById("remove-winner").onclick=()=>{wheel.names.splice(winningIndex,1);winnerBox.innerHTML="";drawWheel();};
  spinBtn.style.display="block";
}
function renderNav(){nav.innerHTML="";wheels.forEach((w,i)=>{let b=document.createElement("div");b.className="wheel-bubble"+(i===activeWheel?" active":"");b.textContent=w.title;b.onclick=()=>{activeWheel=i;drawWheel();renderNav();};nav.appendChild(b);});}
document.getElementById("add-wheel").onclick=()=>{wheels.push({title:`Wheel ${wheels.length+1}`,names:["One","Two","Three"]});activeWheel=wheels.length-1;renderNav();drawWheel();};
document.getElementById("clear-wheels").onclick=()=>{wheels=[{title:"Default Wheel",names:["Alice","Bob","Charlie","Diana"]}];activeWheel=0;renderNav();drawWheel();};
document.getElementById("toggle-theme").onclick=()=>{document.body.classList.toggle("dark");document.body.classList.toggle("light");};
spinBtn.onclick=()=>{spinBtn.style.display="none";spinWheel();};
document.body.classList.add("light");renderNav();drawWheel();
})();